global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 30s

  # Grafana
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    scrape_interval: 30s

  # Alertmanager
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['alertmanager:9093']
    scrape_interval: 30s

  # Node Exporter (Docker host)
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 30s
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'docker-host'

  # Windows Exporter (external Windows hosts)
  - job_name: 'windows'
    static_configs:
      - targets:
          - 'host.docker.internal:9182'  # Windows host
        labels:
          instance: 'windows-host'
    scrape_interval: 30s
    enabled: true

  # Blackbox Exporter for HTTP checks
  - job_name: 'blackbox_http'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - 'http://grafana:3000'          # Grafana health check
          - 'http://prometheus:9090'       # Prometheus health check
          - 'http://alertmanager:9093'     # Alertmanager health check
        labels:
          instance: 'monitoring-stack'
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115

  # SNMP Exporter for network devices
  - job_name: 'snmp'
    static_configs:
      - targets:
          - '192.168.1.1'  # Replace with actual network device IPs
        labels:
          instance: 'network-device-1'
    metrics_path: /snmp
    params:
      module: [if_mib]
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - target_label: __address__
        replacement: snmp-exporter:9116

  # Application health checks (add your applications here)
  - job_name: 'applications'
    static_configs:
      - targets:
          # Add your application endpoints here
          # - 'app1.company.com:80'
          # - 'app2.company.com:443'
        labels:
          instance: 'application-1'
    scrape_interval: 60s

  # Service discovery for Docker containers
  - job_name: 'docker'
    docker_sd_configs:
      - host: unix:///var/run/docker.sock
        refresh_interval: 30s
    relabel_configs:
      - source_labels: [__meta_docker_container_name]
        regex: '/(.*)'
        target_label: container_name
      - source_labels: [__meta_docker_container_name]
        regex: '/(.*)'
        target_label: job
      - source_labels: [__meta_docker_container_label_monitoring]
        regex: 'true'
        action: keep